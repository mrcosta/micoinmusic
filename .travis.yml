sudo: required
services:
- docker
language: java
jdk:
- oraclejdk9
install: true
jobs:
  include:
  - stage: run tests and upload coverage report
    script:
    - docker-compose run test ./gradlew clean test
    - docker-compose run test ./gradlew integrationTest
    - docker-compose run test ./gradlew jacocoTestReport
    - bash <(curl -s https://codecov.io/bash)
  - stage: create jar, build and upload image and deploy to heroku
    script:
    - docker-compose run test ./gradlew bootRepackage
    - sh travis/deploy_dockerhub.sh
    - test “$TRAVIS_BRANCH” = “master” && sh travis/deploy_heroku.sh
env:
  global:
  - secure: QzNKZcuSBu0MNvIra/moXIJYlVTrtbWj1PPXG7D8g1fJ6Bus7WHzRA7P4lmpfV+ymlqddwx+1t/YB9VlcJmXg4Sk6eP4QL7dtuY5prvZQO28pgPnXUtOaP3scjwqKQ7dV8nNMWZpz4uAcq84bMg+RnZqS9pBSyCo94kUdahLWrju8nc9I5wHZ9qj+uRmFPo6AqES4RK/nIUIX9eQjDtjgsFaoB8nkXEwbSEj6tQoAT+2II213KFAXjADfQpk+ycmDQRqq1CK4Viw5f2QxEvA4lYjkKgoyW0ZdIcJtYKXPibxWhRdU1KFYE2MTjH0vFWaVT5epIc2FH9rjDDymDRMMIhQTNu3uW9KwSCMgxP8jtIf9R91jEUEFARzOS0aX4SF1wK9SToCSKFgkvmb0tp6fiRSLAFM0ntW3jH5DswnRPajVQbrDGnSYdOYYozueXg6lWAbx3Cd6A945hYfq8PdeAWekUl9DPTCRrFr+Xf2WyfNLZpjzE3yf3zAm3j+mnutSg3Z1Fj8hVOOtbuCBX+PCjb+FVkm3MqhmusISzFFw0F1MODBu6GP9ZYdscwGUwX5hzhIe/V0HK3sQGxq3Z26PbEK+LEBPE7dGDdj21YvcMJewEFejLh0ncqrDLn5pXViE36lDtnRN9ito5Eu3oXz/MP8vwxamMpLNilbzrHd+MM=
  - secure: eR/uZYDk4zDmPbEYFcVO+yBZpLPOaIfL2OJBHDJIDthhDNRO4Dj2e9dgX4ZN18KdfrcT22G0VF+5c6+cXrmEn9C5zckffzvuaMWW6cspbPiOUrYehbLSxd3PHk9Yh+1UzPb2nljmjRhlBuK4QkVD9PQTcqBt2npk/ugsSNmeNXGm1CZQ5ZXzc93nKtiXvEOF3L98RTaZ6hcd8lCC4EpVh5qlW/R0LpvGG6DmcuPJeMLkB7mvRo4Q/0ZzQ+TQifpHkbdAs7tcs5jn/k5QmN9aa8s1WU1dWstSbx6w9G18XKp+LN7n+n75bYg0ipnZtkoW3llWYpAooZ7+hu4WWhrYE4HcIQwpGsjg/zg4mZpp9v0HPyg/DNYPQ5yj8qNpDgcMS29nMact5SbqcCrRYe7taAgxo+QtP9GF1Jpn1iXQ910nDPP53KDuk+oBehBFRnHQbaNx8OxsIsWZD+G19AIo0VU9wKm0UyRRArmIX3sLvWsSumaliZ9TLmMSFEUKoO0KrhH/iZp3JlUJ7np13vMRoC3ClRBcKFnFfe9TGoNQ3o5yeVvKTJq7ePr2n756/hYUQcA5TGzcDMADGdV6RjwtgF4suUqvqLDBXjCmgUusnEG/nVpXxCAOW5OLGhcIpg4AwsDEU8cJ3N85D8WGu6UY18nz0foVMNt3SUeKBkYiB0c=
  - secure: f0/JjmdD0xK78Dmx+zRc2ThGqZ/RG+mHTVwqvOz60U1b01/xp3jPy9rF3dwC194wCs7mhQkzrxqWexQehN3w/VtXu2CaFM34AjFF+YV+UcoN8ppVw37tZVt1bkcYjRFd4aM2WY4FZ5XH8v2wejFRnLYNuods3cPg5ocnDvSrTmby472cs2iNOczzn48bEgOwX8lZWUzG2iiRjJUkYDLIVXIYPDs7CZDn0DPmZG3TyjQZqoPZ1Gn06PwvTmpaXvi5b12pSC39txGrIrVq/hegQDk4ThLj6t58fMNyiv9Wr1ev/5T/LGbJXP9QA2OoTqmUZxtjp2d8gf2QpoA7rNr8LISpk6zbQHGbA+FBfEs20KLjdHlYL5fTmnvA8BCtJe5IewjNlTv4VWA8RCdJywmIPgzmzStaOTsSSXG7/cknRGxPYXKVzaQuQ/fgCn7BfnzcV9M8/LkIqxJjF8YMfEzLZJ42q5YF756MSKN7hallximjq6Q/36a1sxhzA9hUckaJt6Wvq3N97IOjSHEiLEtb05ofl9U3buVal7jer0PEiV9wJpW/6ELhXhHIs8qnTR1DobZiYKDx04fjGdPItqZCMzGI3P/J377DyRPaomK3fP3lLDwfyZNN97t3u0JB+FgdDfIDefeDCse2yaWI7i/ZY5um3pctqRIFeSkNTezKgtI=
  - secure: CU5rSZWCz5CoBF+A4lhlw/2V+5kQexXBcPB0nYDmnBYkTKYXKz81zlmOSTSEBIo6PhCGvmorKrtHR600M20+cBLyQSH/Kc/aAK+BxvUMRD15nnWHO+JoiWJ3icXiPXd/ZPdhFRrLlYR+9WoP0jD2NV2l6iXKemesBcCEik2fLYnvwdRdE7E+RbXKYSaBJbhA0xBrP8wL/ZX+Dx0tjG24tWnoxIZtR6ah32F9h5xTjUct7wyUz+fMRItajr082FKuD3JsEXf/X/Dhlrh6ui185yLfiV4BWr0oNCxg9K2tW/Cf18LB7iVzAVSM9nRVYDtISJysdjQI44tczRaTACph2yOXlttE2g1qolwvHNqiZCICgT5eplhW8W28cAa7+Iebiz6ZltAkkJbJKV1PivGgoPLrFvhRb9wAqboBWW1/KCbgtI3vZr8dhSgFFKz3/m7Zj+26cX3G1Lj7WTcb0OabK1eTyW4iH9DPQptc8dx8asEAGjRa7UDf77iFaZiRoyOozIy/hy4rTTaY1RMjshYoy/44UrXKi5cKFV7ZoMufUhx7KIoLe+5KcKE/qrtfnRnbQGCBfTwkaCVBvX8utSBWipuzJiRYCAV0ZVXG8kEvnuHv2xSWAafiqRQhI07nJWz9qiuuTFAvb0qoJF6CmHQ1RFKpBg8IzrP49RsNetRea5g=
  - secure: PYeR2FA+vx4j365c1f+Evw64S7GSNQtt42/wOsVhA1wHHEnNMlWo5DaPM9HiRh6nhOEQLL6+Zsp39RN+S5zeRj0xE4MoHvKzzt+R5AvMzGvexuZobGnX83If2SiogK3YG6Qnv6dmCAnx4ce35ArhsvUhnyFtUXFppKtn/zAwlIuFPTrMSrGNEPEzyR20ZO50l5GPxtw02CZhnTGMQ2QfhVNO5l1BTR/fBaUPwfBpOCc6KJxNDudm5X1oB+6qjtF1R2ESs3nmEIORsBl8TgugysFZwrTRANlfhoqTcCq+HNNBEcUWGrOfipLIWTNJt07D52yvCJVIARQ088H7wqnMLu3DSmsKEeJNPxGVvBZu05ERoYdwMH8YSWwZsgfaz/cN+RioqE6ncmFRHjI0MVTe+KUk1SKudXRwDAAKPrsOcFvaN75rUG18exqjLIdKgQw7FrsG6L6WqDAWO6W5lvjWHyqmMmIs+25NcE+vFKJlV4HrYobj3NFoXLqsoyvBjAQo4xy/sY1a1QO1j03Qac/RlOgc3Y/CmQC18nP0OjSpNBE/NBBVWQIFL7bTXPoyeEiLJlv2y8HxoHMrZSXjGTRHWu99X03t/RXYGnpcmh+RdCgwf1vpy6htvRd1EKZOqxjjwcHegavzFoWGDxGG+bHBr7IAHtLGTjBW13oe7s7sb1k=
