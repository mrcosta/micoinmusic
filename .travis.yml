sudo: required

services:
- docker

language: java

jdk:
- oraclejdk8

install: true

jobs:
  include:
  - stage: run tests, upload coverage report and create jar application
    script:
    - docker-compose run test ./gradlew clean test
    - docker-compose run test ./gradlew integrationTest jacocoTestReport
    - bash <(curl -s https://codecov.io/bash)
    - docker-compose run test ./gradlew bootRepackage
  - stage: build, upload image and deploy to heroku
    script:
    - sh travis/deploy_dockerhub.sh
    - test “$TRAVIS_BRANCH” = “master” && sh travis/deploy_heroku.sh
env:
  global:
  - secure: CEc7x46KoCw+md6iC41jlTuCQ34dHvnJjUNWT+Hu3hG8f1dS/YFNxoBHAfjq9DaVnJEdG/PCakpQWEdZ5eNV0bI0g3bI/K9dLHnREw2HK7UmGONFQr61YeL+32b+P1HoV6VaJjpyCHbRz9GDHKglVmw0+l5YIyTBVDw8jj26jmQjckb8M+wF2TBWhU4WbKVu7cqS1zJT3AuWjidHZVnmTLzMMDKkOZSkErith1Aa8XQV+VWEvLCFLOnet/XqzZoGqbj0gf4ba4VEomaiAnuusbY6kSdR4TkH7ZYCyIyVuhNvAXEV4OpEGpWbhIeFg7DZ+j7L5A3NVyVmit4J9ZLS3PmKUKix7Hjw1uGp9Ui/1vrJdkpG2Y6nvEldb7wuti7xTV7MjWRK/17urZhfVUMZOxTTJGap+FcH7Rl/5k0vLfELXCb2sHUD+LwYcsD0EZ/XEv+EFsI3Xp+aBltMtUTd+6qjzKqcAdSUbo+DMoL/zinMVHH9gfxccQdBVD/xrdTy2+uHPYBguvfoHvu2Al5ICGX4QStAFCfRnkLw2cqlmXUgtqDDaxV3MYflGmve/7RtRyslWlEufO7wkKAJ9MNfJ1P4XghB4oaZkkYZ7Jw9WrNCrTfvJBgDAI9VPLQmwjMJ6yxfFpxtBqUorBxqXJiJJ/Pz7zI+wVtzifiXu5TRdhc=
  - secure: bYRS2hTV1n7+I8dmd23jRq4Bg3t6V+7P5e43PfQGBCGAIjsRGzsLtRkyJcZyQAcPzzP+1lt8Le2ayj5d+hNek2rFQi8cN/QeC+0X3tl8KSGG+AJAmosBuTGYxsis+UiebRb7MxKXG1a+y6SaJXR2UPtfDAhsCsAUswgOygn8dKDk0uQFG9e2KCxjpLe5ItfmuZsAIjgx5ix2aQQDJ7qhuKhuw6oIPdp7TG2GUK6Z3V74Hz7aLit4rsX1o9vDRKnk4RqSfC1TeauNAe68eyVOxX/vT6n6SgfLRykrbG9N9M+XU6P/zbOHKu+dhx7sRfAwCeCMC6l/kCWRCkAtdd4YkVPihRAFAjuQcOGVLu+FZXcjHYwT4sNgI1AeAkRRut/FTaAVqkspAHe86EJWCBtQiJA7VLyxBaOo0Lpo2ZJPEYIcBGXzZkaVS7fm/lhCLMGvWnj0MR6eRbyNhHJiFA8G7yoAj9tjWGWiPwwQN0US8f4+yPMoDhFu2Ozj0uXuHTiCN0j8vFsQDMJrCog1giT8xGXn4MrLa/0IDtYw/OJZHfxZk3Mcs3NPnI4WjIa41eOAaMklGtbQ9rGTPCLNzfvggh1D2DFz4M8EIOgd9qYc3lWABCaki3t2IETcqEyVvbAhjI1DjxHzwIACtECjxOvuAISUZVq/ug7w4IsELHZL85Q=
  - secure: Mih7aSCHnpSp4v2KZtc3YDBVZU88nOkeYhIWhBtMY0driAdyZvOZgGCOIHiJrcaB5y2nxWeqOTrsYdBwHW/oivCdkKlebpAjBf8jIvmAYd7ytXFt87Tt/4eHc5KyOyJe2ArSf97r0QyDo0xBZfnnLQKz7aJDFgwAYALjMw8Dtg/L1/cjKkzE6dpJ1nATMZaxyHQ4oC9mZItKpz/WkQ7GqQnFBVI2/os637iXRxM54tRBy49VXHl99wgiEiZSRqr9zw93D66zuy1ahC/bt38eQjfvsL4YhdsyJAmok6sqHnkG7LYFTtBimo+BiqfzG6bhDUTi9kt42BsdDl1uOVPYECY3PbmqAge6u5dgvcD2OB0KeeDmMj4x2Y0Ss9Sm6PbiV02CF9rOZfaGZUEfJMcqAjBwcINIT06jnrh0S7ofQbPn7WxTXMGZ9oT1Uhs9X7hyGLqIF7B0y4fIf5qMnSSwPZHyf+SgzmjvlLQO4cWkKHXgrMSte6+D4/N+yAygzGSkFO6N3Ep2Fe77oSgM7XwH4yoooc9gsrhL8+717wXlK6R3nc+yyaIhKi+bQD+9W0k+QWl75YtTFRtBAPmrEQibIge1i/JsTqEo2DmTVCCHy3Oi4pZq+cfwLkz/SXqjsi1N0bkAOirCqEQnuEtBBDvIhOtjxBuZAxPMZMSZ+Wcix5Y=
  - secure: rQ7Fm/oFy+tE55x1jzDWKaBG5ygII/yKr3SBN3QBRsIPCohFOjj5VLavuhg5x6Q/mz2NVOJMFgUYRhZ+ruI2twj/+C/eRNb5EPMY0fNJPtItWZEP0OVLd+lc7jw6QBD2Wq0418tmyuHs/PxdZUQVCf2EgcgvWIcMgjHKdRagRzdDE0yDvNrOCyCoYCXTPPsVfem/O+uP6l8lM/6g62WnlbHz1XweT3tGufTjcF70tJN6smXqrw1d6eR0P9CSlJiIbsR7qHBZTs5qdedGFlVIgd1OrOOAy2oooJroFk8QpEfjVn1R6kvaMCnLUauBcpAOuBV7wn4lXQZGDue5BGzKLcNI4+CGzbQGEfMgmo6ptqYASGCd0K4tWRJ3myEdBOzu5TMz9j91A8GIAk1xfTPZZusAnN2cjzoECX+TtgF0+hA9uYntrcF0sKqhmX2J7E/dazc+ZugOLead8on3HAOfwqYcMMTh3S7sqrFoIPBY2Hidy4+U+bXUgUe13XaeuvOufNUwSFxf414utif7xyzT5qcCI4vQfxKZV3YhGJAi8vOCp8XU6bGONN6AYS7lF/gIu/ljUBCL8FWQX5ctjymAPxh68dZrmjlLcituFe6DClfB1VrNuuf/hxQWun2tTI5cjzOvQ6KhRSsX7cJXdTyq2rjzGSAcRtcFliW4gL/ViSU=
  - secure: MzoN+K4nmo7j6EwhHeyqhIsQVdHBQKzPQdPJ9o+33yQiCRTC9vPMhICOEYScUKyAkJffCxHpui/jNctZHuzBzBZ4S8KP9qUQ8rKXfQqzPEyLZnPaS3Bkph+rvnWTY8unh09LQxm/tNHgcOQrZR+MvSG3X0KZy2wzOaqvYBRUb41rfeHX85sD6tTzPV2a/RHEAeOS2KqHEUtVOUSq1IOFA0wbRYfKZJ31PQ96q71mePQIhLyeWoDFs8+2000b8/lVPkO2eR05POCuLqcRyn0iwTo6ogQPQChqak2jZaku6DCrvBdN09Gxmk3XMEJfXFpjCfvaetXWoWPv1xYk48DeNe0TDZkmzeViR90pb75JJkB39jjI3NwK0G9b3VNiv2zx4AUc/6lh2BLPnHKZBtuc+pGv1sYb1JyPzA8fWRfut50EjeyhU2YEu7XSYK2L2DKDtM34JNW7qShI416tkxrwEJ7hvF48WV7zxibqdhdQnoJNCHQ1A7W7j48eHaQIIZpoL51FHksfVvoCGz7Txt5PkSiD8kKg0eKc/mHbDVLLu4fn+jLFfYPS9LUXOyHOFz3e0+DRPDlU3ujWXecWplZakXHUcE1ShiUFv0JJvemKqBaOtLPNS1kRS6FNK4Ge5Y5If5u4Nmz9tNTqH/SxQL95vfdeOzIHUXjzRPYJTHQYv8c=
